<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Greenhouse</title>
</head>
<body>
  <h1>Greenhouse status</h1>
  <ul>
    <li>Temperature: <span id="temperature">{{ env.temperature }} Â°C</span></li>
    <li>Soil moisture: <span id="soil">{{ env.soil_moisture }} %</span></li>
    <li>Flap state: <span id="flap">{{ env.flap }}</span></li>
    <li>Pump on: <span id="pump">{{ env.pump }}</span></li>
    <li>Light on: <span id="light">{{ env.light }}</span></li>
  </ul>

  <h2>Configuration</h2>
  <form method="post">
    <label>Max temperature:
      <input type="number" step="0.1" name="temperature_max" value="{{ config.thresholds.temperature_max }}">
    </label><br>
    <label>Min soil moisture:
      <input type="number" step="0.1" name="soil_moisture_min" value="{{ config.thresholds.soil_moisture_min }}">
    </label><br>
    <label>Light start:
      <input type="time" name="light_start" value="{{ config.light_schedule.start }}">
    </label><br>
    <label>Light end:
      <input type="time" name="light_end" value="{{ config.light_schedule.end }}">
    </label><br>
    <button type="submit">Save</button>
  </form>
  <script>
    const evtSource = new EventSource('/stream');
    evtSource.onmessage = function(event) {
      const data = JSON.parse(event.data);
      document.getElementById('temperature').textContent = data.temperature + ' \u00B0C';
      document.getElementById('soil').textContent = data.soil_moisture + ' %';
      document.getElementById('flap').textContent = data.flap;
      document.getElementById('pump').textContent = data.pump;
      document.getElementById('light').textContent = data.light;
    };
  </script>
</body>
</html>
